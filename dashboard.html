<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Amazon Monitor Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-primary: #1e1e1e;
      --bg-secondary: #252526;
      --bg-tertiary: #2d2d30;
      --bg-elevated: #3c3c3c;
      --text-primary: #d4d4d4;
      --text-secondary: #858585;
      --border: #3e3e42;
      --border-light: #5a5a5a;
      --primary: #007acc;
      --primary-hover: #005a9e;
      --success: #4ec9b0;
      --danger: #f44747;
      --warning: #dcdcaa;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }

    .header {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header h1 i { font-size: 1.5rem; color: var(--primary); }

    .status-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .status-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      padding: 1rem;
      border-radius: 4px;
      text-align: center;
    }

    .status-value {
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--text-primary);
    }

    .status-label {
      color: var(--text-secondary);
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
      border-bottom: 1px solid var(--border);
      padding-bottom: 1rem;
    }

    .card-title {
      margin: 0;
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .search-section {
      background: var(--bg-secondary);
    }

    .search-container {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 300px;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 3px;
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-size: 0.875rem;
      transition: border-color 0.2s;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .search-input::placeholder { color: var(--text-secondary); }

    .search-results {
      display: none;
      background: var(--bg-tertiary);
      border-radius: 3px;
      padding: 1rem;
      margin-top: 1rem;
      border: 1px solid var(--border);
    }
    .form-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-row {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .form-control {
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 3px;
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-size: 0.875rem;
      transition: border-color 0.2s;
      width: 100%;
      font-family: inherit;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-control::placeholder { color: var(--text-secondary); }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border-light);
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--primary);
      color: #ffffff;
      border: none;
    }

    .btn-primary:hover { background: var(--primary-hover); }

    .btn-success {
      background: var(--success);
      color: #1e1e1e;
      border: none;
    }

    .btn-success:hover { background: #5dd4b7; }

    .btn-danger {
      background: var(--danger);
      color: #ffffff;
      border: none;
    }

    .btn-danger:hover { background: #f66060; }

    .btn-outline {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      color: var(--text-primary);
    }

    .btn-outline:hover { background: var(--bg-tertiary); }

    .btn-sm { padding: 0.375rem 0.75rem; font-size: 0.75rem; }

    .btn-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .item-grid { display: grid; gap: 1rem; }

    @media (min-width: 768px) {
      .item-grid { grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); }
    }

    .item-card {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 1rem;
      transition: background 0.2s;
    }

    .item-card:hover { background: var(--bg-elevated); }

    .item-header { display: flex; gap: 1rem; margin-bottom: 1rem; }

    .item-image {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 4px;
      flex-shrink: 0;
      border: 1px solid var(--border);
      background: var(--bg-primary);
    }

    .item-details { flex: 1; min-width: 0; }

    .item-title {
      font-weight: 500;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      color: var(--text-primary);
    }

    .item-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .badge {
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .badge-success {
      background: rgba(78, 201, 176, 0.2);
      color: var(--success);
    }

    .badge-danger {
      background: rgba(244, 71, 71, 0.2);
      color: var(--danger);
    }

    .badge-info {
      background: rgba(0, 122, 204, 0.2);
      color: var(--primary);
    }

    .badge-warning {
      background: rgba(220, 220, 170, 0.2);
      color: var(--warning);
    }

    .price-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .current-price {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--success);
    }

    .old-price {
      text-decoration: line-through;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .price-change {
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      font-weight: 500;
      font-size: 0.75rem;
    }

    .price-change.positive {
      background: rgba(244, 71, 71, 0.2);
      color: var(--danger);
    }

    .price-change.negative {
      background: rgba(78, 201, 176, 0.2);
      color: var(--success);
    }

    .item-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-secondary);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .spinner {
      border: 2px solid var(--border);
      border-top: 2px solid var(--primary);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin-right: 0.75rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.75rem 1rem;
      border-radius: 3px;
      font-weight: 500;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      font-size: 0.875rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    .notification.show { transform: translateX(0); }

    .notification.success {
      background: var(--success);
      color: #1e1e1e;
    }

    .notification.error {
      background: var(--danger);
      color: #ffffff;
    }

    .notification.info {
      background: var(--primary);
      color: #ffffff;
    }

    @media (max-width: 768px) {
      .container { padding: 1rem; }
      .header { padding: 1rem; }
      .header h1 { font-size: 1.25rem; }
      .card { padding: 1rem; }
      .item-header { flex-direction: column; }
      .item-image { align-self: center; }
      .form-group { grid-template-columns: 1fr; }
      .search-input { min-width: 100%; }
      .btn-group { justify-content: center; }
      .status-bar { grid-template-columns: 1fr; }
    }

    /* Help Section */
    .help-section {
      margin-top: 1.5rem;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .help-details { border: none; }

    .help-summary {
      padding: 1rem;
      background: var(--bg-tertiary);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 500;
      font-size: 0.875rem;
      color: var(--text-primary);
      transition: background 0.2s;
      list-style: none;
    }

    .help-summary:hover { background: var(--bg-elevated); }

    .help-summary::-webkit-details-marker { display: none; }

    .help-chevron {
      margin-left: auto;
      transition: transform 0.3s ease;
      color: var(--text-secondary);
    }

    .help-details[open] .help-chevron { transform: rotate(180deg); }

    .help-content { padding: 0 1rem 1.5rem 1rem; }

    .help-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .help-item {
      background: var(--bg-elevated);
      padding: 1rem;
      border-radius: 3px;
      border: 1px solid var(--border);
    }

    .help-item h4 {
      color: var(--primary);
      margin: 0 0 0.75rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .help-item p {
      margin: 0 0 0.5rem 0;
      color: var(--text-secondary);
      line-height: 1.5;
      font-size: 0.875rem;
    }

    .help-item ul {
      margin: 0;
      padding-left: 1.25rem;
      font-size: 0.875rem;
    }

    .help-item li {
      margin-bottom: 0.5rem;
      color: var(--text-primary);
      line-height: 1.5;
    }

    .help-item li strong {
      color: var(--primary);
      font-weight: 500;
    }

    /* Tooltip */
    .tooltip {
      position: relative;
      display: inline-flex;
      cursor: help;
      margin-left: 0.25rem;
      color: var(--text-secondary);
      transition: color 0.2s;
    }

    .tooltip:hover { color: var(--primary); }

    .tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-elevated);
      color: var(--text-primary);
      padding: 0.75rem 1rem;
      border-radius: 3px;
      font-size: 0.75rem;
      line-height: 1.4;
      white-space: normal;
      width: 250px;
      max-width: 90vw;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
      font-weight: 400;
      z-index: 1000;
      border: 1px solid var(--border);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    .tooltip::before {
      content: '';
      position: absolute;
      bottom: 115%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: var(--bg-elevated);
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }

    .tooltip:hover::after,
    .tooltip:hover::before {
      opacity: 1;
      visibility: visible;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-shopping-cart"></i> Amazon Monitor Dashboard</h1>
    </div>
    
    <div class="status-bar" id="statusBar">
      <div class="status-card">
        <div class="status-value" id="totalItems">-</div>
        <div class="status-label">Tracked Items</div>
      </div>
      <div class="status-card">
        <div class="status-value" id="nextScan">-</div>
        <div class="status-label">Next Scan</div>
      </div>
      <div class="status-card">
        <div class="status-value" id="scanInterval">-</div>
        <div class="status-label">Scan Interval</div>
      </div>
      <div class="status-card">
        <div class="status-value" id="systemStatus">-</div>
        <div class="status-label">System Status</div>
      </div>
    </div>
    
    <div class="card search-section">
      <div class="card-header">
        <h2 class="card-title"><i class="fas fa-search"></i> Search & Add Products</h2>
      </div>
      
      <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Enter Amazon URL, ASIN, or search term...">
        <button type="button" id="searchBtn" class="btn btn-success"><i class="fas fa-search"></i> Search</button>
      </div>
      
      <div id="searchResults" class="search-results"></div>
      
      <form id="addForm">
        <div class="form-group">
          <div>
            <label>Product URL/ASIN * <span class="tooltip" data-tooltip="Paste a full Amazon product link or just the 10-character product code (ASIN). Example: B0C2XNQNN9"><i class="fas fa-info-circle"></i></span></label>
            <input type="text" id="f_url" class="form-control" placeholder="https://amazon.com/dp/B123... or B123456789" required>
          </div>
          <div>
            <label>Label <span class="tooltip" data-tooltip="A custom name to easily identify this product in your dashboard and notifications"><i class="fas fa-info-circle"></i></span></label>
            <input type="text" id="f_label" class="form-control" placeholder="e.g., Gaming Headset, VR Bundle">
          </div>
          <div>
            <label>Group <span class="tooltip" data-tooltip="Optional category to organize your products (e.g., Electronics, Books, Clothing)"><i class="fas fa-info-circle"></i></span></label>
            <input type="text" id="f_group" class="form-control" placeholder="e.g., Electronics, Books">
          </div>
        </div>
        
        <div class="form-group">
          <div>
            <label>Price Threshold <span class="tooltip" data-tooltip="Only alert when the price drops to or below this amount. Leave empty for any price drop."><i class="fas fa-info-circle"></i></span></label>
            <input type="number" id="f_threshold" class="form-control" placeholder="e.g., 199.99" step="0.01" min="0">
          </div>
          <div>
            <label>Threshold Drop % <span class="tooltip" data-tooltip="Alert when price drops by this percentage. Example: 10 = alert when 10% cheaper than baseline"><i class="fas fa-info-circle"></i></span></label>
            <input type="number" id="f_drop" class="form-control" placeholder="e.g., 15" step="1" min="1" max="90">
          </div>
          <div>
            <label>Baseline <span class="tooltip" data-tooltip="What price to compare percentage drops against: Last=most recent price, Lowest=best price ever seen, Start=first price when added"><i class="fas fa-info-circle"></i></span></label>
            <select id="f_base" class="form-control">
              <option value="">Last Price (Default)</option>
              <option value="last">Last Price</option>
              <option value="lowest">Lowest Price Ever</option>
              <option value="start">Starting Price</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <div>
            <label>Amazon Warehouse <span class="tooltip" data-tooltip="Warehouse deals are discounted returns/open-box items. On=prefer warehouse deals, Off=ignore warehouse, Only=warehouse deals only"><i class="fas fa-info-circle"></i></span></label>
            <select id="f_warehouse" class="form-control">
              <option value="">Use Global Setting</option>
              <option value="on">Include Warehouse Deals</option>
              <option value="off">Exclude Warehouse Deals</option>
              <option value="only">Warehouse Deals Only</option>
            </select>
          </div>
          <div>
            <label>Alert Types <span class="tooltip" data-tooltip="Choose what triggers notifications: All=price drops & restocks, Stock=restock only, Price=price drops only, None=no alerts"><i class="fas fa-info-circle"></i></span></label>
            <select id="f_alerts" class="form-control">
              <option value="">All Alerts (Price + Stock)</option>
              <option value="stock">Back-in-Stock Only</option>
              <option value="price">Price Drops Only</option>
              <option value="none">No Alerts</option>
            </select>
          </div>
          <div style="display: flex; align-items: end;">
            <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Product</button>
          </div>
        </div>
      </form>
      
      <!-- Help Section -->
      <div class="help-section">
        <details class="help-details">
          <summary class="help-summary">
            <i class="fas fa-question-circle"></i>
            <span>Need help? Click here for detailed explanations</span>
            <i class="fas fa-chevron-down help-chevron"></i>
          </summary>
          <div class="help-content">
            <div class="help-grid">
              <div class="help-item">
                <h4><i class="fas fa-link"></i> URLs & ASINs</h4>
                <p>You can add products using:</p>
                <ul>
                  <li><strong>Full Amazon URLs:</strong> https://amazon.com/dp/B0C2XNQNN9</li>
                  <li><strong>Just the ASIN:</strong> B0C2XNQNN9 (10-character product code)</li>
                  <li><strong>Search above:</strong> Find products by searching product names</li>
                </ul>
              </div>
              
              <div class="help-item">
                <h4><i class="fas fa-dollar-sign"></i> Price Thresholds</h4>
                <p>Control when you get notified:</p>
                <ul>
                  <li><strong>Fixed Threshold:</strong> Alert only when price â‰¤ $199.99</li>
                  <li><strong>Percentage Drop:</strong> Alert when price drops by 15%</li>
                  <li><strong>Both:</strong> Use both for maximum control</li>
                </ul>
              </div>
              
              <div class="help-item">
                <h4><i class="fas fa-warehouse"></i> Amazon Warehouse</h4>
                <p>Discounted open-box & returned items:</p>
                <ul>
                  <li><strong>Include:</strong> Monitor both regular & warehouse prices</li>
                  <li><strong>Only:</strong> Track warehouse deals exclusively</li>
                  <li><strong>Exclude:</strong> Ignore warehouse, regular prices only</li>
                </ul>
              </div>
              
              <div class="help-item">
                <h4><i class="fas fa-bell"></i> Smart Notifications</h4>
                <p>Get alerts via Discord and/or Telegram:</p>
                <ul>
                  <li><strong>Price Drops:</strong> When prices decrease</li>
                  <li><strong>Back in Stock:</strong> When out-of-stock items return</li>
                  <li><strong>Threshold Alerts:</strong> When your price targets are met</li>
                </ul>
              </div>
              
              <div class="help-item">
                <h4><i class="fas fa-cogs"></i> Pro Tips</h4>
                <ul>
                  <li><strong>Labels:</strong> Use clear names like "Gaming Mouse" instead of model numbers</li>
                  <li><strong>Groups:</strong> Organize with categories like "Electronics", "Books"</li>
                  <li><strong>Multiple Items:</strong> Add the same product with different thresholds</li>
                  <li><strong>Test Alerts:</strong> Use the test button to verify notifications work</li>
                </ul>
              </div>
              
              <div class="help-item">
                <h4><i class="fas fa-shield-alt"></i> Rate Limiting</h4>
                <p>Built-in protection against Amazon blocks:</p>
                <ul>
                  <li><strong>Scan Frequency:</strong> Checks every 10+ minutes by default</li>
                  <li><strong>Delays:</strong> 60+ seconds between each item</li>
                  <li><strong>Cooldowns:</strong> Automatic pauses if rate limited</li>
                  <li><strong>User Agents:</strong> Rotates browser identities</li>
                </ul>
              </div>
            </div>
          </div>
        </details>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h2 class="card-title"><i class="fas fa-list"></i> Tracked Products</h2>
        <div class="btn-group">
          <button id="btn_reload" class="btn btn-outline"><i class="fas fa-sync"></i> Refresh</button>
          <button id="btn_scan" class="btn btn-success"><i class="fas fa-play"></i> Scan Now</button>
        </div>
      </div>
      
      <div id="items" class="loading">
        <div class="spinner"></div> Loading products...
      </div>
    </div>
  </div>

  <script src="dashboard.js"></script>
</body>
</html>